/*! Built with http://stenciljs.com */
const{h:t}=window.App;import{a as e,b as a}from"./chunk-63d140c8.js";import{e as s,f as i,g as h,h as n}from"./chunk-8d9c18af.js";var r,o=(function(t){function e(t){if(!(this instanceof e))return new e(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}t.exports=e,e.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,e){e=void 0===e?15:e;var a=this._circle=this._createCanvas(),s=a.getContext("2d"),i=this._r=t+e;return a.width=a.height=2*i,s.shadowOffsetX=s.shadowOffsetY=2*i,s.shadowBlur=e,s.shadowColor="black",s.beginPath(),s.arc(-i,-i,t,0,2*Math.PI,!0),s.closePath(),s.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var e=this._createCanvas(),a=e.getContext("2d"),s=a.createLinearGradient(0,0,0,256);for(var i in e.width=1,e.height=256,t)s.addColorStop(+i,t[i]);return a.fillStyle=s,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var a,s=0,i=this._data.length;s<i;s++)a=this._data[s],e.globalAlpha=Math.max(a[2]/this._max,void 0===t?.05:t),e.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var h=e.getImageData(0,0,this._width,this._height);return this._colorize(h.data,this._grad),e.putImageData(h,0,0),this},_colorize:function(t,e){for(var a,s=0,i=t.length;s<i;s+=4)(a=4*t[s+3])&&(t[s]=e[a],t[s+1]=e[a+1],t[s+2]=e[a+2])},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}}(r={exports:{}}),r.exports);class l{constructor(){this.legends=[],this.min=1,this.max=275e6,this.heatMax=40,this.heatSize=4,this.heatBlur=0,this.height=100,this.width=300;const t=Math.log10(this.min),a=(Math.log10(this.max)-t)/10;let s=t;for(let t=0;t<10;t++){let t=Math.pow(10,s);this.legends.push(e(t)),s+=a}}async componentDidLoad(){const t=this.el.querySelector("canvas");this.heat=o(t),this.updateHeap()}updateHeap(){this.heat&&this.data&&(this.heat.clear(),this.heat.data(this.data),this.heat.max(40),this.heat.radius(8,4),this.heat.draw())}render(){requestAnimationFrame(()=>{this.updateHeap()});const e=[];return this.label&&this.label.length>0&&e.push(t("h3",null,this.label)),e.push(t("div",{style:{width:`${this.width}px`,height:`${this.height}px`}},t("canvas",{width:this.width,style:{transform:`scaleY(${this.height/2})`},height:2}))),e.push(t("div",{class:"legend"},this.legends.map(e=>t("div",null,e)))),e}static get is(){return"my-heatmap"}static get properties(){return{data:{type:"Any",attr:"data"},el:{elementRef:!0},heatBlur:{type:Number,attr:"heat-blur"},heatMax:{type:Number,attr:"heat-max"},heatSize:{type:Number,attr:"heat-size"},height:{type:Number,attr:"height"},label:{type:String,attr:"label"},max:{type:Number,attr:"max"},min:{type:Number,attr:"min"},width:{type:Number,attr:"width"}}}static get style(){return"my-heatmap{margin-bottom:2rem 0;display:block;border-bottom:3px solid #e4e4e4;background:#fff}my-heatmap canvas{display:block;-webkit-transform-origin:top;transform-origin:top}my-heatmap h3{font-size:2.2rem;font-weight:400;margin-left:2rem}my-heatmap>.legend{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;font-size:1rem;color:#9a9a9a;font-weight:600}my-heatmap>.legend>div{white-space:nowrap}"}}class d{constructor(){this.maps=[],this.count=0}onInput(t){if(this.data){const e=t.target.value;this.scheduleSearch(e)}}onInputEnter(){this.addHeapMap()}async componentDidLoad(){const t=await fetch("assets/data/data.json");this.data=await t.json(),this.maxValue=Math.log10(this.data[this.data.length-1].max),this.width=this.el.offsetWidth,this.addHeapMap()}getText(){return this.el.querySelector("input").value}addHeapMap(){const t=this.getHeapMap();t&&(t.label=this.getText()),this.maps.push({data:this.search(this.getText()),width:this.width}),this.update()}scheduleSearch(t){clearInterval(this.tr),this.tr=setTimeout(()=>this.setData(this.search(t)),100)}getHeapMap(){return this.maps[this.maps.length-1]}setData(t){this.getHeapMap().data=t,this.update()}search(t){return a(this.data,this.width/this.maxValue,t)}async openDetailPage(t){if(t){const e=await this.modalCtrl.create({component:"page-details",componentProps:{label:t,data:this.data}});await e.present()}}update(){this.count=this.count+1}render(){const e=this.maps;return[t("ion-header",null,t("ion-toolbar",{color:"dark"},t("ion-buttons",{slot:"start"},t("ion-menu-button",null)),t("ion-title",null,"Busqueda por nombre"))),t("ion-content",null,t("ion-searchbar",null),t("div",null,e.map(e=>(a=this,s=e.label,i=e.width,h=e.data,t("my-heatmap",{label:s,width:i,data:h,onClick:function(t){const e=t.target.closest("my-heatmap").label;a.openDetailPage(e)}}))).reverse()))];var a,s,i,h}static get is(){return"page-home"}static get properties(){return{count:{state:!0},el:{elementRef:!0},modalCtrl:{connect:"ion-modal-controller"}}}static get listeners(){return[{name:"input",method:"onInput"},{name:"keydown.enter",method:"onInputEnter"}]}static get style(){return"#heapmap{-webkit-transform-origin:top;transform-origin:top;-webkit-transform:scaleY(50);transform:scaleY(50)}"}}class c{constructor(){this.modals=new Map}modalWillPresent(t){this.modals.set(t.target.overlayId,t.target)}modalWillDismiss(t){this.modals.delete(t.target.overlayId)}escapeKeyUp(){n(this.modals)}create(t){return s(this.doc.createElement("ion-modal"),t)}dismiss(t,e,a=-1){return i(t,e,this.modals,a)}getTop(){return h(this.modals)}static get is(){return"ion-modal-controller"}static get properties(){return{create:{method:!0},dismiss:{method:!0},doc:{context:"document"},getTop:{method:!0}}}static get listeners(){return[{name:"body:ionModalWillPresent",method:"modalWillPresent"},{name:"body:ionModalWillDismiss",method:"modalWillDismiss"},{name:"body:ionModalDidUnload",method:"modalWillDismiss"},{name:"body:keyup.escape",method:"escapeKeyUp"}]}}export{l as MyHeatmap,d as PageHome,c as IonModalController};